buildscript {
    repositories {
        mavenLocal()
        jcenter()
    }
}

group 'org.coindirect'
version '0.38'

apply plugin: 'groovy'
apply plugin: 'java'
apply plugin: 'maven-publish'

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    mavenLocal()
    mavenCentral()
}


dependencies {
    implementation 'org.java-websocket:Java-WebSocket:1.3.0'
    implementation 'com.google.code.findbugs:jsr305:3.0.1'
    api 'org.slf4j:slf4j-api:1.7.25'
    // https://mvnrepository.com/artifact/org.json/json
    implementation group: 'org.json', name: 'json', version: '20180130'

    testImplementation 'junit:junit:4.12'
    testImplementation('org.robolectric:robolectric:3.0') {
        exclude module: 'httpclient'
    }
    testImplementation 'org.mockito:mockito-core:2.+'
    testImplementation 'com.squareup.okhttp3:okhttp:3.2.0'
    testImplementation 'com.squareup.okhttp:mockwebserver:2.7.5'
    testImplementation 'commons-codec:commons-codec:1.9'
    testImplementation files('lib/testcontainers-1.0.5.jar')
}


publishing.publications {
    mavenJava(MavenPublication) {
        from components.java

        pom.withXml {
            asNode().get('dependencies').get(0).get('dependency').each() { dep ->
                String pomVer = dep.get("version").text()
                String pomArtifactId = dep.get("artifactId").text()
                String pomGroupId = dep.get("groupId").text()
                if(pomVer.isEmpty()){
                    def depVer = project.dependencyManagement.dependencyManagementContainer.globalDependencyManagement.versions["$pomGroupId:$pomArtifactId"]
                    dep.appendNode('version',depVer)
                }
            }
        }
    }
}
